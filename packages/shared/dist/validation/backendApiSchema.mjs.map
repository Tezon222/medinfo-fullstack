{"version":3,"file":"backendApiSchema.mjs","names":[],"sources":["../../src/validation/backendApiSchema.ts"],"sourcesContent":["import { fallBackRouteSchemaKey, type FallBackRouteSchemaKey } from \"@zayne-labs/callapi/constants\";\r\nimport { defineSchema, defineSchemaRoutes } from \"@zayne-labs/callapi/utils\";\r\nimport { z } from \"zod\";\r\n\r\nconst HealthTipSchema = z.object({\r\n\tid: z.string(),\r\n\timageAlt: z.string(),\r\n\timageUrl: z.string(),\r\n\tlastUpdated: z.string(),\r\n\tmainContent: z.array(\r\n\t\tz.object({\r\n\t\t\tcontent: z.string(),\r\n\t\t\ttitle: z.string(),\r\n\t\t})\r\n\t),\r\n\ttitle: z.string(),\r\n});\r\n\r\nconst DiseaseSchema = z.object({\r\n\t/* eslint-disable perfectionist/sort-objects */\r\n\tname: z.string(),\r\n\tdescription: z.string(),\r\n\t/* eslint-enable perfectionist/sort-objects */\r\n\timage: z.url(),\r\n\tprecautions: z.array(z.string()),\r\n\tsymptoms: z.array(z.string()),\r\n});\r\n\r\nconst BaseSuccessResponseSchema = z.object({\r\n\tdata: z.record(z.string(), z.unknown()),\r\n\tmessage: z.string(),\r\n\tstatus: z.literal(\"success\"),\r\n});\r\n\r\nconst BaseErrorResponseSchema = z.object({\r\n\terrors: z.record(z.string(), z.string().or(z.array(z.string()))).or(z.undefined()),\r\n\tmessage: z.string(),\r\n\tstatus: z.literal(\"error\"),\r\n});\r\n\r\nexport type BaseApiSuccessResponse<TData = z.infer<typeof BaseSuccessResponseSchema.shape.data>> = Omit<\r\n\tz.infer<typeof BaseSuccessResponseSchema>,\r\n\t\"data\"\r\n> & {\r\n\tdata: TData;\r\n};\r\n\r\nexport type BaseApiErrorResponse<TErrors = z.infer<typeof BaseErrorResponseSchema>[\"errors\"]> = Omit<\r\n\tz.infer<typeof BaseErrorResponseSchema>,\r\n\t\"errors\"\r\n> & {\r\n\terrors: TErrors;\r\n};\r\n\r\nconst withBaseSuccessResponse = <TSchemaObject extends z.ZodType>(dataSchema: TSchemaObject) =>\r\n\tz.object({\r\n\t\t...BaseSuccessResponseSchema.shape,\r\n\t\tdata: dataSchema,\r\n\t});\r\n\r\nconst withBaseErrorResponse = <\r\n\tTSchemaObject extends z.ZodType = typeof BaseErrorResponseSchema.shape.errors,\r\n>(\r\n\terrorSchema?: TSchemaObject\r\n) =>\r\n\tz.object({\r\n\t\t...BaseErrorResponseSchema.shape,\r\n\t\terrors: (errorSchema ?? BaseErrorResponseSchema.shape.errors) as NonNullable<TSchemaObject>,\r\n\t});\r\n\r\nconst defaultSchemaRoute = defineSchemaRoutes({\r\n\t[fallBackRouteSchemaKey]: {\r\n\t\terrorData: withBaseErrorResponse(),\r\n\t},\r\n});\r\n\r\nconst stringWithNumberValidation = (key: string) =>\r\n\tz\r\n\t\t.transform(String)\r\n\t\t.transform(Number)\r\n\t\t.refine((value) => !Number.isNaN(value), `${key} must be a number`)\r\n\t\t.refine((value) => value > 0, `${key} must be greater than 0`);\r\n\r\nconst healthTipRoutes = defineSchemaRoutes({\r\n\t\"@get/health-tips/all\": {\r\n\t\tdata: withBaseSuccessResponse(\r\n\t\t\tz.array(HealthTipSchema.omit({ lastUpdated: true, mainContent: true }))\r\n\t\t),\r\n\t\tquery: z\r\n\t\t\t.object({ limit: stringWithNumberValidation(\"Limit\") })\r\n\t\t\t.partial()\r\n\t\t\t.optional(),\r\n\t},\r\n\r\n\t\"@get/health-tips/one/:id\": {\r\n\t\tdata: withBaseSuccessResponse(HealthTipSchema),\r\n\t\tparams: z.object({ id: z.string() }),\r\n\t},\r\n});\r\n\r\nconst diseaseRoutes = defineSchemaRoutes({\r\n\t\"@delete/diseases/delete\": {\r\n\t\tbody: z.object({\r\n\t\t\tname: z.string(),\r\n\t\t}),\r\n\t\tdata: withBaseSuccessResponse(z.null()),\r\n\t},\r\n\r\n\t\"@get/diseases/all\": {\r\n\t\tdata: withBaseSuccessResponse(\r\n\t\t\tz.object({\r\n\t\t\t\t// eslint-disable-next-line perfectionist/sort-objects\r\n\t\t\t\tdiseases: z.array(DiseaseSchema.pick({ name: true, description: true, image: true })),\r\n\t\t\t\tlimit: z.number(),\r\n\t\t\t\tpage: z.number(),\r\n\t\t\t\ttotal: z.number(),\r\n\t\t\t})\r\n\t\t),\r\n\t\tquery: z\r\n\t\t\t.object({\r\n\t\t\t\tlimit: stringWithNumberValidation(\"Limit\"),\r\n\t\t\t\tpage: stringWithNumberValidation(\"Page\"),\r\n\t\t\t\trandom: z\r\n\t\t\t\t\t.transform(String)\r\n\t\t\t\t\t.transform((value) => {\r\n\t\t\t\t\t\tif (value === \"true\") {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (value === \"false\") {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn \"unknown\";\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.refine((value) => value !== \"unknown\", \"random must be 'true' or 'false'\"),\r\n\t\t\t})\r\n\t\t\t.partial()\r\n\t\t\t.optional(),\r\n\t},\r\n\r\n\t\"@get/diseases/one/:name\": {\r\n\t\tdata: withBaseSuccessResponse(DiseaseSchema),\r\n\t\tparams: z.object({ name: z.string() }),\r\n\t},\r\n\r\n\t\"@patch/diseases/update\": {\r\n\t\tbody: z.object({\r\n\t\t\tdetails: DiseaseSchema,\r\n\t\t\tname: z.string(),\r\n\t\t}),\r\n\t\tdata: withBaseSuccessResponse(DiseaseSchema),\r\n\t},\r\n\r\n\t\"@post/diseases/add\": {\r\n\t\tbody: z.object({\r\n\t\t\tdetails: DiseaseSchema,\r\n\t\t}),\r\n\t\tdata: withBaseSuccessResponse(DiseaseSchema),\r\n\t},\r\n});\r\n\r\nexport const backendApiSchema = defineSchema(\r\n\t{\r\n\t\t...defaultSchemaRoute,\r\n\t\t...diseaseRoutes,\r\n\t\t...healthTipRoutes,\r\n\t},\r\n\t{ strict: true }\r\n);\r\n\r\nexport const backendApiSchemaRoutes = backendApiSchema.routes;\r\n\r\nexport type RouteSchemaKeys = Exclude<keyof typeof backendApiSchemaRoutes, FallBackRouteSchemaKey>;\r\n\r\nexport type BackendApiSchemaRoutes = Omit<typeof backendApiSchemaRoutes, FallBackRouteSchemaKey>;\r\n\r\nexport type DiseaseSchemaType = z.infer<typeof DiseaseSchema>;\r\n\r\nexport type HealthTipSchemaType = z.infer<typeof HealthTipSchema>;\r\n"],"mappings":"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"}